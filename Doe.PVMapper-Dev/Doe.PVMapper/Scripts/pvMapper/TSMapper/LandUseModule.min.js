var INLModules;(function(n){var i=function(){function n(){var n=this,t;this.starRatingHelper=new pvMapper.StarRatingHelper({defaultStarRating:2,noCategoryRating:4,noCategoryLabel:"None"}),this.federalLandsWmsUrl="http://dingo.gapanalysisprogram.com/ArcGIS/services/PADUS/PADUS_owner/MapServer/WMSServer",this.federalLandsRestUrl="http://dingo.gapanalysisprogram.com/ArcGIS/rest/services/PADUS/PADUS_owner/MapServer/",this.landBounds=new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),t=new pvMapper.Module({id:"ProtectedAreasModule",author:"Leng Vang, INL",version:"0.1.ts",activate:function(){n.addMap()},deactivate:function(){n.removeMap()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Protected Areas",description:"Overlapping protected areas, using PAD-US map data hosted by UI-GAP (gap.uidaho.edu)",category:"Land Use",onSiteChange:function(t,i){n.updateScore(i)},getStarRatables:function(){return n.starRatingHelper.starRatings},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,5,"stars")},weight:10}],infoTools:null})}return n.prototype.addMap=function(){this.federalLandsLayer=new OpenLayers.Layer.WMS("Protected Areas",this.federalLandsWmsUrl,{maxExtent:this.landBounds,layers:"0",layer_type:"polygon",transparent:"true",format:"image/gif",exceptions:"application/vnd.ogc.se_inimage",maxResolution:156543.0339,srs:"EPSG:102113"},{isBaseLayer:!1}),this.federalLandsLayer.epsgOverride="EPSG:102113",this.federalLandsLayer.setOpacity(.3),this.federalLandsLayer.setVisibility(!1),pvMapper.map.addLayer(this.federalLandsLayer)},n.prototype.removeMap=function(){pvMapper.map.removeLayer(this.federalLandsLayer,!1)},n.prototype.updateScore=function(n){var t=this,i={mapExtent:n.site.geometry.bounds.toBBOX(6,!1),geometryType:"esriGeometryEnvelope",geometry:n.site.geometry.bounds.toBBOX(6,!1),f:"json",layers:"0",tolerance:0,imageDisplay:"1, 1, 96",returnGeometry:!1},r=OpenLayers.Request.GET({url:this.federalLandsRestUrl+"identify",proxy:"/Proxy/proxy.ashx?",params:i,callback:function(i){var c,r,e,f,a;if(i.status===200)if(c=new OpenLayers.Format.JSON,c.extractAttributes=!0,r=c.read(i.responseText),r&&r.results&&r.results.length>0){for(e=[],f=0;f<r.results.length;f++){var o=r.results[f].attributes["Primary Designation Name"],l=r.results[f].attributes["Primary Designation Type"],s=r.results[f].attributes["Owner Name"],h=r.results[f].attributes["Manager Name"],u="";o&&o!="Null"&&isNaN(parseFloat(o))?u+=o:l&&l!="Null"&&(u+=l),h&&h!="Null"?u+=u?": "+h:h:s&&s!="Null"&&(u+=u?": "+s:s),e.indexOf(u)<0&&e.push(u)}a=t.starRatingHelper.sortRatableArray(e),n.popupMessage=a,n.updateValue(t.starRatingHelper.starRatings[e[0]])}else n.popupMessage=t.starRatingHelper.options.noCategoryLabel,n.updateValue(t.starRatingHelper.starRatings[t.starRatingHelper.options.noCategoryLabel]);else n.popupMessage="Error "+i.status,n.updateValue(Number.NaN)}})},n}(),r,t,u;n.ProtectedAreasModule=i,r=new n.ProtectedAreasModule,t=function(){function n(){var n=this,t;this.ratables={},this.defaultRating=3,this.landCoverRestUrl="http://dingo.gapanalysisprogram.com/ArcGIS/rest/services/NAT_LC/1_NVC_class_landuse/MapServer/",this.landBounds=new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),t=new pvMapper.Module({id:"LandCoverModule",author:"Leng Vang, INL",version:"0.1.ts",activate:function(){n.addMap()},deactivate:function(){n.removeMap()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Land Cover",description:"The type of land cover found in the center of a site, using NLCD map data hosted by UI-GAP (gap.uidaho.edu)",category:"Land Use",onSiteChange:function(t,i){n.updateScore(i)},getStarRatables:function(){return n.ratables},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,5,"stars")},weight:10}],infoTools:null})}return n.prototype.addMap=function(){this.landCoverLayer=new OpenLayers.Layer.ArcGIS93Rest("Land Cover",this.landCoverRestUrl+"export",{layers:"show:0,1,2",format:"gif",srs:"3857",transparent:"true"}),this.landCoverLayer.setOpacity(.3),this.landCoverLayer.epsgOverride="3857",this.landCoverLayer.setVisibility(!1),pvMapper.map.addLayer(this.landCoverLayer)},n.prototype.removeMap=function(){pvMapper.map.removeLayer(this.landCoverLayer,!1)},n.prototype.updateScore=function(n){var t=this,i={mapExtent:n.site.geometry.bounds.toBBOX(6,!1),geometryType:"esriGeometryEnvelope",geometry:n.site.geometry.bounds.toBBOX(6,!1),f:"json",layers:"all",tolerance:0,imageDisplay:"1, 1, 96",returnGeometry:!1},r=OpenLayers.Request.GET({url:this.landCoverRestUrl+"identify",proxy:"/Proxy/proxy.ashx?",params:i,callback:function(i){var h,r,f,e,o,s,u;if(i.status===200)if(h=new OpenLayers.Format.JSON,h.extractAttributes=!0,r=h.read(i.responseText),r&&r.results&&r.results.length>0){for(console.assert(r.results.length===1,"Warning: land cover score tool unexpectedly found more than one land cover type"),f="",e=null,o=0;o<r.results.length;o++)s=r.results[o].attributes.NVC_DIV,s!=e&&(e!=null&&(f+=", \n"),f+=s),e=s;u=t.ratables[f],typeof u=="undefined"&&(u=t.ratables[f]=t.defaultRating),n.popupMessage=f+" ["+u+(u===1?" star]":" stars]"),n.updateValue(u)}else n.popupMessage="No data for this site",n.updateValue(Number.NaN);else n.popupMessage="Error "+i.status,n.updateValue(Number.NaN)}})},n}(),n.LandCoverModule=t,u=new n.LandCoverModule})(INLModules||(INLModules={}))