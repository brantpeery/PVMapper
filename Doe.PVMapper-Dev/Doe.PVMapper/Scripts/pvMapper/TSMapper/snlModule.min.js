var INLModules;(function(){function f(){t=new OpenLayers.Layer.ArcGIS93Rest("Power Lines",r,{layers:"show:5",format:"gif",srs:"3857",transparent:"true"}),t.setOpacity(.3),t.epsgOverride="3857",t.setVisibility(!1),pvMapper.map.addLayer(t)}function e(){pvMapper.map.removeLayer(t,!1)}function o(t){var i=230,r=new OpenLayers.Protocol.Script({url:u,params:{f:"json",where:"Voltage >= "+i+"AND Line_Name NOT LIKE '%\\N%'",outFields:"*",geometryType:"esriGeometryEnvelope",geometry:new OpenLayers.Bounds(t.site.geometry.bounds.left-n,t.site.geometry.bounds.bottom-n,t.site.geometry.bounds.right+n,t.site.geometry.bounds.top+n).toBBOX(0,!1)},format:new OpenLayers.Format.EsriGeoJSON,parseFeatures:function(n){return this.format.read(n)},callback:function(r){var f,e,u,o,s;if(r.success()){if(f=null,e=n,r.features)for(u=0;u<r.features.length;u++)o=t.site.geometry.distanceTo(r.features[u].geometry),s=r.features[u].attributes.Voltage,o<e&&s>=i&&(e=o,f=r.features[u]);f!==null?(t.popupMessage=(e/1e3).toFixed(1)+" km to "+f.attributes.Voltage+" kV line operated by "+f.attributes.Company,t.updateValue(e)):(t.popupMessage="No "+i+" kV line found within "+n/1e3+" km",t.updateValue(n))}else t.popupMessage="Request error "+r.error.toString(),t.updateValue(Number.NaN)}}),f=r.read()}var n=3e4,i=function(){function t(){var t=new pvMapper.Module({id:"SnlModule",author:"Scott Brown, INL",version:"0.1.ts",iconURL:"http://www.iconshock.com/img_jpg/MODERN/general/jpg/16/home_icon.jpg",activate:function(){f()},deactivate:function(){e()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Nearest Transmission Line",description:"Distance from a site boundary to the nearest known transmission line, using data from SNL",category:"Transmission Availability",onScoreAdded:function(){},onSiteChange:function(n,t){o(t)},scoreUtilityOptions:{functionName:"linear3pt",functionArgs:new pvMapper.ThreePointUtilityArgs(0,1,n-1,.3,n,0)},defaultWeight:10}],infoTools:null})}return t}(),s=new i,r="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/export",u="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/5/query",t})(INLModules||(INLModules={}))