var INLModules;(function(){function e(){t=new OpenLayers.Layer.WMS("Power Lines",u+"WMSServer",{layers:"5",transparent:"true",format:"image/png",srs:"EPSG:3857"},{isBaseLayer:!1}),t.setOpacity(.3),t.epsgOverride="EPSG:3857",t.setVisibility(!1),pvMapper.map.addLayer(t)}function o(){pvMapper.map.removeLayer(t,!1)}function i(t){var i=230,r=new OpenLayers.Protocol.Script({url:f,params:{f:"json",where:"Voltage >= "+i+"AND Line_Name NOT LIKE '%\\N%'",outFields:"*",geometryType:"esriGeometryEnvelope",geometry:new OpenLayers.Bounds(t.site.geometry.bounds.left-n,t.site.geometry.bounds.bottom-n,t.site.geometry.bounds.right+n,t.site.geometry.bounds.top+n).toBBOX(0,!1)},format:new OpenLayers.Format.EsriGeoJSON,parseFeatures:function(n){return this.format.read(n)},callback:function(r){var f,e,u,o,s;if(r.success()){if(f=null,e=n,r.features)for(u=0;u<r.features.length;u++)o=t.site.geometry.distanceTo(r.features[u].geometry),s=r.features[u].attributes.Voltage,o<e&&s>=i&&(e=o,f=r.features[u]);f!==null?(t.popupMessage=(e/1e3).toFixed(1)+" km to "+f.attributes.Voltage+" kV line operated by "+f.attributes.Company,t.updateValue(e)):(t.popupMessage="No "+i+" kV line found within "+n/1e3+" km",t.updateValue(n))}else t.popupMessage="Request error "+r.error.toString(),t.updateValue(Number.NaN)}}),u=r.read()}var n=3e4,r=function(){function t(){var t=new pvMapper.Module({id:"SnlModule",author:"Scott Brown, INL",version:"0.1.ts",activate:function(){e()},deactivate:function(){o()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Nearest Transmission Line",description:"Calculates the distance to the nearest known transmission line",category:"Transmission Availability",onScoreAdded:function(){},onSiteChange:function(n,t){i(t)},updateScoreCallback:function(n){i(n)},scoreUtilityOptions:{functionName:"linear3pt",p0:{x:0,y:1},p1:{x:n-1,y:.3},p2:{x:n,y:0}},defaultWeight:10}],infoTools:null})}return t}(),s=new r,u="https://maps.snl.com/arcgis/services/SNLMaps/PowerCos/MapServer/",f="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/5/query",t})(INLModules||(INLModules={}))