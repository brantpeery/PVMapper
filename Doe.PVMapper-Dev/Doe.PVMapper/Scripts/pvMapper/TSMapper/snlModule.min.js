var INLModules;(function(){function f(){n=new OpenLayers.Layer.WMS("Power Lines",r+"WMSServer",{layers:"5",transparent:"true",format:"image/png",srs:"EPSG:3857"},{isBaseLayer:!1}),n.setOpacity(.3),n.epsgOverride="EPSG:3857",n.setVisibility(!1),pvMapper.map.addLayer(n)}function e(){pvMapper.map.removeLayer(n,!1)}function t(n){var t=2e4,i=230,r=new OpenLayers.Protocol.Script({url:u,params:{f:"json",where:"Voltage >= "+i+"AND Line_Name NOT LIKE '%\\N%'",outFields:"*",geometryType:"esriGeometryEnvelope",geometry:new OpenLayers.Bounds(n.site.geometry.bounds.left-t,n.site.geometry.bounds.bottom-t,n.site.geometry.bounds.right+t,n.site.geometry.bounds.top+t).toBBOX(0,!1)},format:new OpenLayers.Format.EsriGeoJSON,parseFeatures:function(n){return this.format.read(n)},callback:function(r){var f,e,u,o,s;if(r.success()){if(f=null,e=t,r.features)for(u=0;u<r.features.length;u++)o=n.site.geometry.distanceTo(r.features[u].geometry),s=r.features[u].attributes.Voltage,o<e&&s>=i&&(e=o,f=r.features[u]);f!==null?(n.popupMessage=(e/1e3).toFixed(1)+" km to "+f.attributes.Voltage+" kV line operated by "+f.attributes.Company,n.updateValue(r.features.length)):(n.popupMessage="No "+i+" kV line found within "+t/1e3+" km",n.updateValue(Number.NaN))}else n.popupMessage="Request error "+r.error.toString(),n.updateValue(Number.NaN)}}),f=r.read()}var i=function(){function n(){var n=new pvMapper.Module({id:"SnlModule",author:"Scott Brown, INL",version:"0.1.ts",activate:function(){f()},deactivate:function(){e()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Nearest Transmission Line",description:"Calculates the distance to the nearest known transmission line",onScoreAdded:function(){},onSiteChange:function(n,i){t(i)},updateScoreCallback:function(n){t(n)}}],infoTools:null})}return n}(),o=new i,r="https://maps.snl.com/arcgis/services/SNLMaps/PowerCos/MapServer/",u="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/5/query",n})(INLModules||(INLModules={}))