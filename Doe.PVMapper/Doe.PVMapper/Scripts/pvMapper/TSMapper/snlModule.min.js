var INLModules;(function(){function s(){t=new OpenLayers.Layer.ArcGIS93Rest("Power Lines",e,{layers:"show:5",format:"gif",srs:"3857",transparent:"true"}),t.setOpacity(.3),t.epsgOverride="3857",t.setVisibility(!1),pvMapper.map.addLayer(t)}function h(){pvMapper.map.removeLayer(t,!1)}function u(t){var i=n.maxSearchDistanceInKM*1e3,r=new OpenLayers.Protocol.Script({url:o,params:{f:"json",where:"Voltage >= "+n.minimumVoltage+" AND Voltage <= "+n.maximumVoltage+" AND Line_Name NOT LIKE '%\\N%'",outFields:"*",geometryType:"esriGeometryEnvelope",geometry:new OpenLayers.Bounds(t.site.geometry.bounds.left-i-1e3,t.site.geometry.bounds.bottom-i-1e3,t.site.geometry.bounds.right+i+1e3,t.site.geometry.bounds.top+i+1e3).toBBOX(0,!1)},format:new OpenLayers.Format.EsriGeoJSON,parseFeatures:function(n){return this.format.read(n)},callback:function(r){var f,e,u,o,s,h;if(r.success()){if(f=null,e=i,r.features)for(u=0;u<r.features.length;u++)o=t.site.geometry.distanceTo(r.features[u].geometry),s=r.features[u].attributes.Voltage,o<e&&s>=n.minimumVoltage&&s<=n.maximumVoltage&&(e=o,f=r.features[u]);f!==null?(t.popupMessage=(e/1e3).toFixed(1)+" km to "+f.attributes.Voltage+" kV line operated by "+f.attributes.Company,t.updateValue(e/1e3)):(h=n.minimumVoltage!==n.maximumVoltage?n.minimumVoltage+"-"+n.maximumVoltage:""+n.minimumVoltage,t.popupMessage="No "+h+" kV line found within "+n.maxSearchDistanceInKM+" km",t.updateValue(n.maxSearchDistanceInKM))}else t.popupMessage="Request error "+r.error.toString(),t.updateValue(Number.NaN)}}),u=r.read()}var n={maxSearchDistanceInKM:30,minimumVoltage:230,maximumVoltage:765},r,i;Ext.onReady(function(){var t={allowBlank:!1,displayField:"display",valueField:"value",store:{fields:["display","value"],data:[{display:"230 kV",value:230},{display:"345 kV",value:345},{display:"500 kV",value:500},{display:"768 kV",value:765}]},typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0},f=Ext.create("Ext.grid.property.Grid",{nameText:"Properties Grid",minWidth:300,source:n,customRenderers:{maxSearchDistanceInKM:function(n){return n+" km"},minimumVoltage:function(n){return n+" kV"},maximumVoltage:function(n){return n+" kV"}},propertyNames:{maxSearchDistanceInKM:"search distance",minimumVoltage:"minimum voltage ",maximumVoltage:"maximum voltage "},customEditors:{minimumVoltage:Ext.create("Ext.form.ComboBox",t),maximumVoltage:Ext.create("Ext.form.ComboBox",t)}});i=Ext.create("Ext.window.Window",{title:"Configure Nearest Transmission Line Tool",closeAction:"hide",layout:"fit",items:[f],listeners:{beforehide:function(){r.scores.forEach(u)}},buttons:[{xtype:"button",text:"OK",handler:function(){i.hide()}}],constrain:!0})});var f=function(){function t(){var t=new pvMapper.Module({id:"SnlModule",author:"Scott Brown, INL",version:"0.2.ts",iconURL:"http://www.iconshock.com/img_jpg/MODERN/general/jpg/16/home_icon.jpg",activate:function(){s()},deactivate:function(){h()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,showConfigWindow:function(){r=this,i.show()},title:"Nearest Transmission Line",description:"Distance from a site boundary to the nearest known transmission line, using data from SNL",category:"Power Infrastructure",onSiteChange:function(n,t){u(t)},scoreUtilityOptions:{functionName:"linear3pt",functionArgs:new pvMapper.ThreePointUtilityArgs(0,1,n.maxSearchDistanceInKM-1,.3,n.maxSearchDistanceInKM,0,"km")},weight:10}],infoTools:null})}return t}(),c=new f,e="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/export",o="https://maps.snl.com/arcgis/rest/services/SNLMaps/Power/MapServer/5/query",t})(INLModules||(INLModules={}))