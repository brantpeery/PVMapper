var pvMapper;(function(n){var t=function(){function t(){}return t.basicWindow={_xArgs:{},setup:function(i,r){function v(){Extras.getScript("https://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.97/jsxgraphcore.js",function(){var h=c(s),g=h[0]==h[1]?1:(h[1]-h[0])/10,a,w,b;h[0]-=g,h[1]+=g*1.5,f=JXG.JSXGraph.initBoard("FunctionBox-body",{boundingbox:[h[0],108,h[1],-8],axis:!0,showCopyright:!1,showNavigation:!0}),l=f.create("functiongraph",function(n){var t=e(n,u._xArgs);return Math.max(0,Math.min(1,t))*100},{strokeWidth:3,strokeColor:"red"});var k=f.getBoundingBox(),d=(k[2]-k[0])/2+k[0],p=e(d,u._xArgs)*100,t=f.create("segment",[[d,0],[d,p]],{name:(k[2]/2).toFixed(1)+" "+u._xArgs.metaInfo.unitSymbol,withLabel:!0,strokeColor:"blue",dash:2,strokeOpacity:.15}),nt=n.getColorForScore(p),i=f.create("segment",[[0,p],[t.point1.X(),p]],{name:"Score: "+p.toFixed(0),withLabel:!0,strokeColor:nt,dash:2,strokeWidth:4,strokeOpacity:1});t.on("drag",function(){f.suspendUpdate();var r=e(t.point1.X(),u._xArgs);r=Math.max(0,Math.min(1,r))*100,t.labelColor("red"),t.setLabelText(t.point1.X().toFixed(1)+" "+u._xArgs.metaInfo.unitSymbol),t.point1.moveTo([t.point1.X(),0]),t.point2.moveTo([t.point1.X(),r]),i.labelColor("red"),i.setLabelText("Score: "+r.toFixed(0)),i.visProp.strokecolor=n.getColorForScore(r),i.point1.moveTo([0,r]),i.point2.moveTo([t.point1.X(),r]),f.unsuspendUpdate()});i.on("drag",function(){f.suspendUpdate();var n=e(t.point1.X(),u._xArgs)*100;i.point1.moveTo([0,n]),i.point2.moveTo([t.point1.X(),n]),f.unsuspendUpdate()});if(a=function(){f.suspendUpdate();var r=e(t.point1.X(),u._xArgs);r=Math.max(0,Math.min(1,r))*100,t.point2.moveTo([t.point1.X(),r]),i.setLabelText("Score: "+r.toFixed(2)),i.point1.moveTo([0,r]),i.point2.moveTo([t.point1.X(),r]),i.visProp.strokecolor=n.getColorForScore(r),f.unsuspendUpdate()},u._xArgs.metaInfo.name=="ThreePointUtilityArgs")u._xArgs.points!=undefined&&u._xArgs.points.length>0&&u._xArgs.points.forEach(function(n){var t=f.create("point",[u._xArgs[n].x,u._xArgs[n].y*100],{name:n,size:3});t.on("drag",function(){u._xArgs[n].x=t.X(),u._xArgs[n].y=t.Y()/100,a()})});else if(u._xArgs.metaInfo.name=="MinMaxUtilityArgs"){w=f.create("point",[u._xArgs.minValue,0],{name:"Min",size:3});w.on("drag",function(){u._xArgs.minValue=w.X(),f.update(),w.moveTo([w.X(),0]),o.setSource(u._xArgs),a()});b=f.create("point",[u._xArgs.maxValue,100],{name:"Max",size:3});b.on("drag",function(){u._xArgs.maxValue=b.X(),f.update(),b.moveTo([b.X(),100]),o.setSource(u._xArgs),a()})}else if(u._xArgs.metaInfo.name=="SinusoidalUtilityArgs"){var v=f.create("point",[u._xArgs.minValue,0],{name:"Min",size:3}),y=f.create("point",[u._xArgs.maxValue,100],{name:"Max",size:3}),r=f.create("point",[u._xArgs.target,50],{name:"target",size:3}),tt=f.create("line",[r,[function(){return r.X()},0]],{dash:2,size:1,strokeOpacity:.15}),it=f.create("line",[r,[0,function(){return r.Y()}]],{dash:2,size:1,strokeOpacity:.15});v.on("drag",function(){var n=v.X();n>r.X()&&(n=r.X()),u._xArgs.minValue=n,f.update(),v.moveTo(n,v.Y()),a()});y.on("drag",function(){var n=y.X();n<r.X()&&(n=r.X()),u._xArgs.maxValue=n,f.update(),y.moveTo(n,y.Y()),a()});r.on("drag",function(){var n=r.X();n<v.X()&&(n=v.X()),n>y.X()&&(n=y.X()),u._xArgs.targetValue=n,f.update(),r.moveTo(n,r.Y()),a()})}})}var s=r.functionArgs,e=n.UtilityFunctions[r.functionName].fn,c=n.UtilityFunctions[r.functionName].xBounds,u=this,f,l,o,a,h;u._xArgs=Ext.Object.merge({},s),i.removeAll(),h=Ext.create("Ext.data.Store",{fields:["Name","Function"],data:[{Name:"3 points",Function:"ThreePointUtilityArgs"},{Name:"Min-Max",Function:"MinMaxUtilityArgs"},{Name:"Less-More",Function:"SinusoidalUtilityArgs"}]}),a=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"Utility Function",store:h,queryMode:"local",displayField:"Name",valueField:"Function",renderTo:Ext.getBody(),listeners:{afterrender:function(){typeof u!="undefined"&&typeof u._xArgs!="undefined"&&(this.setValue(u._xArgs.metaInfo.name,!0),this.fireEvent("select",this))},select:function(f){if(f.value!=u._xArgs.metaInfo.name){u._xArgs.metaInfo.name=f.value;switch(f.value){case"ThreePointUtilityArgs":r.functionName="linear3pt",r.functionArgs=new n.ThreePointUtilityArgs(0,.5,180,1,360,.5,"degrees"),t.basicWindow.setup(i,r),i.doLayout();break;case"MinMaxUtilityArgs":r.functionName="linear",r.functionArgs=new n.MinMaxUtilityArgs(10,0,"degrees"),t.basicWindow.setup(i,r),i.doLayout();break;case"SinusoidalUtilityArgs":r.functionName="sinusoidal",r.functionArgs=new n.SinusoidalUtilityArgs(0,100,0,0,"degrees"),t.basicWindow.setup(i,r),i.doLayout()}}}}}),o=Ext.create("Ext.grid.property.Grid",{source:u._xArgs,tipValue:null,viewConfig:{deferEmptyText:!1,emptyText:"<center><i>no editable fields<\/i><\/center>"},listeners:{edit:function(){f.update()},propertychange:function(){f.update()},itemmouseenter:function(n,t){this.tipValue=this.source.metaInfo!=undefined?this.source.metaInfo[t.internalId+"Tip"]:"Property "+t.internalId,this.tip.update(this.tipValue)},itemmouseleave:function(){this.tipValue=null},render:function(n){var t=this;n.tip=Ext.create("Ext.tip.ToolTip",{target:n.el,delegate:n.cellSelector,trackMouse:!0,renterTo:Ext.getBody(),listeners:{beforeshow:function(n){n.update(t.tipValue)}}})}}}),i.add(o),i.add({xtype:"panel",layout:{align:"center",pack:"center",type:"vbox"},items:{id:"FunctionBox",xtype:"panel",layout:"fit",border:!0,width:200,height:225,padding:5},listeners:{afterrender:function(){v()}}})},okhandler:function(n,t){Ext.apply(t,this._xArgs)}},t}();n.ScoreUtilityWindows=t})(pvMapper||(pvMapper={}))