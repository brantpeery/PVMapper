var INLModules;(function(n){var i=function(){function n(){var n=this,t;this.starRatingHelper=new pvMapper.StarRatingHelper({defaultStarRating:2,noCategoryRating:4,noCategoryLabel:"None"}),this.federalLandsWmsUrl="http://dingo.gapanalysisprogram.com/ArcGIS/services/PADUS/PADUS_owner/MapServer/WMSServer",this.federalLandsRestUrl="http://dingo.gapanalysisprogram.com/ArcGIS/rest/services/PADUS/PADUS_owner/MapServer/",this.landBounds=new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),t=new pvMapper.Module({id:"ProtectedAreasModule",author:"Leng Vang, INL",version:"0.1.ts",activate:function(){n.addMap()},deactivate:function(){n.removeMap()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Protected Areas",description:"Overlapping protected areas, using PAD-US map data hosted by UI-GAP (gap.uidaho.edu)",category:"Land Use",onSiteChange:function(t,i){n.updateScore(i)},getStarRatables:function(){return n.starRatingHelper.starRatings},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,5,"stars")},weight:10}],infoTools:null})}return n.prototype.addMap=function(){this.federalLandsLayer=new OpenLayers.Layer.WMS("Protected Areas",this.federalLandsWmsUrl,{maxExtent:this.landBounds,layers:"0",layer_type:"polygon",transparent:"true",format:"image/gif",exceptions:"application/vnd.ogc.se_inimage",maxResolution:156543.0339,srs:"EPSG:102113"},{isBaseLayer:!1}),this.federalLandsLayer.epsgOverride="EPSG:102113",this.federalLandsLayer.setOpacity(.3),this.federalLandsLayer.setVisibility(!1),pvMapper.map.addLayer(this.federalLandsLayer)},n.prototype.removeMap=function(){pvMapper.map.removeLayer(this.federalLandsLayer,!1)},n.prototype.updateScore=function(n){var t=this,i={mapExtent:n.site.geometry.bounds.toBBOX(6,!1),geometryType:"esriGeometryEnvelope",geometry:n.site.geometry.bounds.toBBOX(6,!1),f:"json",layers:"0",tolerance:0,imageDisplay:"1, 1, 96",returnGeometry:!1},r=OpenLayers.Request.GET({url:this.federalLandsRestUrl+"identify",proxy:"/Proxy/proxy.ashx?",params:i,callback:function(i){var c,r,e,f,a;if(i.status===200)if(c=new OpenLayers.Format.JSON,c.extractAttributes=!0,r=c.read(i.responseText),r&&r.results&&r.results.length>0){for(e=[],f=0;f<r.results.length;f++){var o=r.results[f].attributes["Primary Designation Name"],l=r.results[f].attributes["Primary Designation Type"],s=r.results[f].attributes["Owner Name"],h=r.results[f].attributes["Manager Name"],u="";o&&o!="Null"&&isNaN(parseFloat(o))?u+=o:l&&l!="Null"&&(u+=l),h&&h!="Null"?u+=u?": "+h:h:s&&s!="Null"&&(u+=u?": "+s:s),e.indexOf(u)<0&&e.push(u)}a=t.starRatingHelper.sortRatableArray(e),n.popupMessage=a,n.updateValue(t.starRatingHelper.starRatings[e[0]])}else n.popupMessage=t.starRatingHelper.options.noCategoryLabel,n.updateValue(t.starRatingHelper.starRatings[t.starRatingHelper.options.noCategoryLabel]);else n.popupMessage="Error "+i.status,n.updateValue(Number.NaN)}})},n}(),r,t,u;n.ProtectedAreasModule=i,r=new n.ProtectedAreasModule,t=function(){function n(){var n=this,t;this.landCoverRestUrl="http://dingo.gapanalysisprogram.com/ArcGIS/rest/services/NAT_LC/1_NVC_class_landuse/MapServer/",this.landBounds=new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),this.starRatingHelper1=new pvMapper.StarRatingHelper({defaultStarRating:4}),t=new pvMapper.Module({id:"LandCoverModule",author:"Leng Vang, INL, Rohit Khattar BYU",version:"0.2.ts",activate:function(){n.addMap()},deactivate:function(){n.removeMap()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Land Cover",description:"The types of Land cover found in the selected area. Using data hosted on Geoserver.byu.edu",category:"Land Use",onSiteChange:function(t,i){n.updateScore(i)},getStarRatables:function(){return n.starRatingHelper1.starRatings},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,5,"stars")},weight:10}],infoTools:null})}return n.prototype.addMap=function(){this.landCoverLayer=new OpenLayers.Layer.ArcGIS93Rest("Land Cover",this.landCoverRestUrl+"export",{layers:"show:0,1,2",format:"gif",srs:"3857",transparent:"true"}),this.landCoverLayer.setOpacity(.3),this.landCoverLayer.epsgOverride="3857",this.landCoverLayer.setVisibility(!1),pvMapper.map.addLayer(this.landCoverLayer)},n.prototype.removeMap=function(){pvMapper.map.removeLayer(this.landCoverLayer,!1)},n.prototype.updateScore=function(n){var i=this,t="landCover"+n.site.id;isNaN(n.value)&&$.jStorage.get(t)&&(n.popupMessage="<i>"+$.jStorage.get(t+"msg")+"<\/i>",n.updateValue($.jStorage.get(t)));var i=this,r=new OpenLayers.Format.GeoJSON,u=r.extract.geometry.apply(r,[n.site.geometry]),f=new geoJsonConverter,e=f.toEsri(u),o={displayFieldName:"",features:[{geometry:e}]},s=OpenLayers.Request.POST({url:"https://geoserver.byu.edu/arcgis/rest/services/land_cover/GPServer/land_cover/submitJob",proxy:"/Proxy/proxy.ashx?",data:OpenLayers.Util.getParameterString({inpoly:JSON.stringify(o)})+"+&env%3AoutSR=&env%3AprocessSR=&returnZ=false&returnM=false&f=pjson",headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:function(r){var u;if(r.status===200){u=new OpenLayers.Format.JSON,u.extractAttributes=!0;var e=u.read(r.responseText),s=i,o=e.jobId,f=setInterval(function(){console.log("Job Still Processing");var r=OpenLayers.Request.GET({url:"https://geoserver.byu.edu/arcgis/rest/services/land_cover/GPServer/land_cover/jobs/"+o+"/results/Extract_nlcd1_TableSelect?f=json",proxy:"/Proxy/proxy.ashx?",callback:function(r){var a,o,v,b,e,h,y,u,l,w;if(r.status==200){if(a=new OpenLayers.Format.JSON,a.extractAttributes=!0,o=a.read(r.responseText),!o.error)if(clearInterval(f),o&&o.value.features[0].attributes.Value){for(v=o.value.features.length,b=null,console.log(v),e=[],h=null,u=0;u<v;u++)h=o.value.features[u].attributes,y=Math.round(h.Percent),y>1&&e.push({cover:h.LandCover,percent:y});function k(n,t){return n.percent-t.percent}e.sort(k),e.reverse();var s=0,p=0,c="";for(u=0;u<e.length;u++)typeof i.starRatingHelper1.starRatings[e[u].cover]=="undefined"&&(i.starRatingHelper1.starRatings[e[u].cover]=i.starRatingHelper1.options.defaultStarRating),l=i.starRatingHelper1.starRatings[e[u].cover],p+=e[u].percent,s+=e[u].percent*l,w=e[u].percent+"% "+e[u].cover+" ["+l+(l===1?" star]":" stars]"),c+=(c.length?", ":"")+w;s=s/p,n.popupMessage=c,n.updateValue(s),$.jStorage.deleteKey(t),$.jStorage.deleteKey(t+"msg"),$.jStorage.set(t,s),$.jStorage.set(t+"msg",c)}else n.popupMessage="No landcover found",n.updateValue(Number.NaN)}else clearInterval(f),n.popupMessage="Error "+r.status,n.updateValue(Number.NaN)}})},1e4)}else n.popupMessage="Error "+r.status,n.updateValue(Number.NaN)}})},n}(),n.LandCoverModule=t,u=new n.LandCoverModule})(INLModules||(INLModules={}))