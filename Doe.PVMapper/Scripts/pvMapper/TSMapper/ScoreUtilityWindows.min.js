var pvMapper;(function(n){var t=function(){function t(){}return t.basicWindow={_xArgs:{},_scoreObj:{},setup:function(t,i){function a(){Extras.getScript("https://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.97/jsxgraphcore.js",function(){var s=h(o),g=s[0]==s[1]?1:(s[1]-s[0])/10,d,l,a,p,w;s[0]-=g,s[1]+=g*1.5,u=JXG.JSXGraph.initBoard("FunctionBox-body",{boundingbox:[s[0],108,s[1],-8],axis:!0,showCopyright:!1,showNavigation:!0}),c=u.create("functiongraph",function(n){var t=f(n,r._xArgs);return Math.max(0,Math.min(1,t))*100},{strokeWidth:3,strokeColor:"red"}),d=u.getBoundingBox(),r._xArgs.metaInfo.vline==undefined||r._xArgs.metaInfo.vline<=0?(l=(d[2]-d[0])/2+d[0],r._xArgs.metaInfo.vline=l):l=r._xArgs.metaInfo.vline;var y=f(l,r._xArgs)*100,t=u.create("segment",[[l,0],[l,y]],{name:l.toFixed(1)+" "+r._xArgs.metaInfo.unitSymbol,withLabel:!0,strokeColor:"blue",dash:2,strokeOpacity:.15}),rt=n.getColorForScore(y),i=u.create("segment",[[0,y],[t.point1.X(),y]],{name:"Score: "+y.toFixed(0),withLabel:!0,strokeColor:rt,dash:2,strokeWidth:4,strokeOpacity:1});t.on("drag",function(){u.suspendUpdate(),r._xArgs.metaInfo.vline=t.point1.X();var e=f(t.point1.X(),r._xArgs);e=Math.max(0,Math.min(1,e))*100,t.labelColor("red"),t.setLabelText(t.point1.X().toFixed(1)+" "+r._xArgs.metaInfo.unitSymbol),t.point1.moveTo([t.point1.X(),0]),t.point2.moveTo([t.point1.X(),e]),i.labelColor("red"),i.setLabelText("Score: "+e.toFixed(0)),i.visProp.strokecolor=n.getColorForScore(e),i.point1.moveTo([0,e]),i.point2.moveTo([t.point1.X(),e]),u.unsuspendUpdate()});i.on("drag",function(){u.suspendUpdate();var n=f(t.point1.X(),r._xArgs)*100;i.point1.moveTo([0,n]),i.point2.moveTo([t.point1.X(),n]),u.unsuspendUpdate()});if(a=function(){u.suspendUpdate();var e=f(t.point1.X(),r._xArgs);e=Math.max(0,Math.min(1,e))*100,t.point2.moveTo([t.point1.X(),e]),i.setLabelText("Score: "+e.toFixed(2)),i.point1.moveTo([0,e]),i.point2.moveTo([t.point1.X(),e]),i.visProp.strokecolor=n.getColorForScore(e),u.unsuspendUpdate()},r._xArgs.metaInfo.name=="ThreePointUtilityArgs")r._xArgs.points!=undefined&&r._xArgs.points.length>0&&r._xArgs.points.forEach(function(n){var t=u.create("point",[r._xArgs[n].x,r._xArgs[n].y*100],{name:n,size:3});t.on("drag",function(){r._xArgs[n].x=t.X(),r._xArgs[n].y=t.Y()/100,a()})});else if(r._xArgs.metaInfo.name=="MinMaxUtilityArgs"){p=u.create("point",[r._xArgs.minValue,0],{name:"Min",size:3});p.on("drag",function(){r._xArgs.minValue=p.X(),u.update(),p.moveTo([p.X(),0]),e.setSource(r._xArgs),a()});w=u.create("point",[r._xArgs.maxValue,100],{name:"Max",size:3});w.on("drag",function(){r._xArgs.maxValue=w.X(),u.update(),w.moveTo([w.X(),100]),e.setSource(r._xArgs),a()})}else if(r._xArgs.metaInfo.name=="SinusoidalUtilityArgs"){var nt=f(r._xArgs.minValue,r._xArgs)*100,tt=f(r._xArgs.maxValue,r._xArgs)*100,it=f(r._xArgs.target,r._xArgs)*100,b=u.create("point",[r._xArgs.minValue,nt],{name:"Min",size:3}),k=u.create("point",[r._xArgs.maxValue,tt],{name:"Max",size:3}),v=u.create("point",[r._xArgs.target,it],{name:"target",size:3});b.on("drag",function(){var n=b.X();n>v.X()&&(n=v.X()),r._xArgs.minValue=n,u.update(),b.moveTo([n,nt]),e.setSource(r._xArgs),a()});k.on("drag",function(){var n=k.X();n<v.X()&&(n=v.X()),r._xArgs.maxValue=n,u.update(),k.moveTo([n,tt]),e.setSource(r._xArgs),a()});v.on("drag",function(){var n=v.X();n<b.X()&&(n=b.X()),n>k.X()&&(n=k.X()),r._xArgs.target=n,u.update(),v.moveTo([n,it]),e.setSource(r._xArgs),a()})}})}var r=this,e,l,s;r._scoreObj=i;var o=i.functionArgs,f=n.UtilityFunctions[i.functionName].fn,h=n.UtilityFunctions[i.functionName].xBounds,u,c;r._xArgs=Ext.Object.merge({},o),r.functionName=i.functionName,t.removeAll(),s=Ext.create("Ext.data.Store",{fields:["Name","Function"],data:[{Name:"3 points",Function:"ThreePointUtilityArgs"},{Name:"Min-Max",Function:"MinMaxUtilityArgs"},{Name:"Less-More",Function:"SinusoidalUtilityArgs"}]}),l=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"Utility Function",store:s,queryMode:"local",displayField:"Name",valueField:"Function",renderTo:Ext.getBody(),listeners:{afterrender:function(){typeof r!="undefined"&&typeof r._xArgs!="undefined"&&(this.setValue(r._xArgs.metaInfo.name,!0),this.fireEvent("select",this))},select:function(u){var f,o,s,h,e;if(u.value!=r._xArgs.metaInfo.name){f=Ext.apply({},i);switch(u.value){case"ThreePointUtilityArgs":f.functionName!=undefined&&r._xArgs!=undefined&&(f.fCache[f.functionName]=r._xArgs),f.functionName="linear3pt",f.fCache[f.functionName]!=undefined?o=f.fCache[f.functionName]:(o=new n.ThreePointUtilityArgs(0,.5,180,1,360,.5,"degrees"),o.metaInfo.vline=180),f.functionArgs=o,e=n.UtilityFunctions[f.functionName],e.windowSetup.apply(e,[t,f]),r._scoreObj=f,r.functionName=f.functionName,r._xArgs=f.functionArgs;break;case"MinMaxUtilityArgs":f.functionName!=undefined&&r._xArgs!=undefined&&(f.fCache[f.functionName]=r._xArgs),f.functionName="linear",f.fCache[f.functionName]!=undefined?s=f.fCache[f.functionName]:(s=new n.MinMaxUtilityArgs(10,0,"degrees"),s.metaInfo.vline=5),f.functionArgs=s,e=n.UtilityFunctions[f.functionName],e.windowSetup.apply(e,[t,f]),r._scoreObj=f,r.functionName=f.functionName,r._xArgs=f.functionArgs;break;case"SinusoidalUtilityArgs":f.functionName!=undefined&&r._xArgs!=undefined&&(f.fCache[f.functionName]=r._xArgs),f.functionName="sinusoidal",f.fCache[f.functionName]!=undefined?h=f.fCache[f.functionName]:(h=new n.SinusoidalUtilityArgs(0,100,50,.5,"degrees"),h.metaInfo.vline=50),f.functionArgs=h,e=n.UtilityFunctions[f.functionName],e.windowSetup.apply(e,[t,f]),r._scoreObj=f,r.functionName=f.functionName,r._xArgs=f.functionArgs}}}}}),e=Ext.create("Ext.grid.property.Grid",{source:r._xArgs,tipValue:null,viewConfig:{deferEmptyText:!1,emptyText:"<center><i>no editable fields<\/i><\/center>"},listeners:{edit:function(){u.update()},propertychange:function(){u.update()},itemmouseenter:function(n,t){this.tipValue=this.source.metaInfo!=undefined?this.source.metaInfo[t.internalId+"Tip"]:"Property "+t.internalId,this.tip.update(this.tipValue)},itemmouseleave:function(){this.tipValue=null},render:function(n){var t=this;n.tip=Ext.create("Ext.tip.ToolTip",{target:n.el,delegate:n.cellSelector,trackMouse:!0,renterTo:Ext.getBody(),listeners:{beforeshow:function(n){n.update(t.tipValue)}}})}}}),t.add(e),t.add({xtype:"panel",layout:{align:"center",pack:"center",type:"vbox"},items:{id:"FunctionBox",xtype:"panel",layout:"fit",border:!0,width:200,height:225,padding:5},listeners:{afterrender:function(){a()}}}),t.doLayout()},okhandler:function(n,t){t.functionArgs=this._xArgs,t.functionName=this.functionName}},t}();n.ScoreUtilityWindows=t})(pvMapper||(pvMapper={}))