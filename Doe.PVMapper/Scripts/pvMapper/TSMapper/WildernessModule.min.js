var BYUModules;(function(n){var t=function(){function n(){var n=this,t;this.WildernessRestUrl="https://geoserver.byu.edu/arcgis/rest/services/Layers/nat_parks/MapServer/",this.landBounds=new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508.34),t=new pvMapper.Module({id:"WildernessModule",author:"Darian Ramage",version:"0.1.ts",activate:function(){n.addMap()},deactivate:function(){n.removeMap()},destroy:null,init:null,scoringTools:[{title:"Wilderness",description:"Overlapping national parks, using data hosted by BYU",category:"Land Use",onScoreAdded:function(){},onSiteChange:function(t,i){n.updateScore(i)},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(1,0,"parks","Minimum Wilderness threshold allowed.","Maximum Wilderness threshold allowed.")},weight:10}],infoTools:null})}return n.prototype.addMap=function(){this.wildernessLayer=new OpenLayers.Layer.ArcGIS93Rest("Wilderness Areas",this.WildernessRestUrl+"export",{format:"gif",layers:"show: 0",srs:"3857",transparent:"true"},{isBaseLayer:!1}),this.wildernessLayer.setVisibility(!1),pvMapper.map.addLayer(this.wildernessLayer)},n.prototype.removeMap=function(){pvMapper.map.removeLayer(this.wildernessLayer,!1)},n.prototype.updateScore=function(n){var i=new OpenLayers.Format.GeoJSON,u=i.extract.geometry.apply(i,[n.site.geometry]),f=new geoJsonConverter,t=f.toEsri(u),r,e;console.log("Converted Geometry:"),console.log("Esri Json: "+t),r={mapExtent:n.site.geometry.bounds,geometryType:"esriGeometryPolygon",geometry:JSON.stringify(t),f:"json",layers:"all",tolerance:0,imageDisplay:"1, 1, 96",returnGeometry:!1},e=OpenLayers.Request.GET({url:this.WildernessRestUrl+"identify",proxy:"/Proxy/proxy.ashx?",params:r,callback:function(i){var u,r;i.status==200?(u=new OpenLayers.Format.JSON,u.extractAttributes=!0,r=u.read(i.responseText),console.log("Wilderness Module Response: "+i.responseText),console.log("geometry: "+t.toString()),console.log("geometry bbox: "+n.site.geometry.bounds.toBBOX(6,!1)),r&&r.results?r.results.length>0?(n.popupMessage=r.results[0].value,n.updateValue(1)):(n.popupMessage="No National Park Overlaps",n.updateValue(0)):(n.popupMessage="Parse error",n.updateValue(Number.NaN))):(n.popupMessage="Error "+i.status,n.updateValue(Number.NaN))}})},n}(),i;n.WildernessModule=t,i=new n.WildernessModule})(BYUModules||(BYUModules={}))