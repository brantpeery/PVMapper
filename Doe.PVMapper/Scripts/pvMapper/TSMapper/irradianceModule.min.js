var INLModules;(function(){function e(){t=u("swera:dni_suny_high_900913","Direct-Normal Irradiation 10km"),pvMapper.map.addLayer(t),i=u("swera:ghi_suny_high_900913","Global-Horizontal Irradiation 10km"),pvMapper.map.addLayer(i)}function u(n,t){var i=new OpenLayers.Layer.WMS(t,r,{layers:n,transparent:"true",format:"image/png",exceptions:"application/vnd.ogc.se_inimage",maxResolution:156543.0339,srs:"EPSG:900913"},{isBaseLayer:!1});return i.setOpacity(.3),i.setVisibility(!1),i}function o(){pvMapper.map.removeLayer(t,!1),pvMapper.map.removeLayer(i,!1)}function n(n,t){var i={REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_xml",BBOX:n.site.geometry.bounds.toBBOX(6,!1),SERVICE:"WMS",INFO_FORMAT:"application/vnd.ogc.gml",QUERY_LAYERS:t,FEATURE_COUNT:50,Layers:t,WIDTH:1,HEIGHT:1,format:"image/gif",VERSION:"1.1.1",X:0,Y:0,I:0,J:0},u=OpenLayers.Request.GET({url:r,proxy:"/Proxy/proxy.ashx?",params:i,callback:s(n)})}function s(n){return function(t){var u,i,f,r;try{if(t.status===200)if(u=new OpenLayers.Format.GML,u.extractAttributes=!0,i=u.read(t.responseText),typeof i!="undefined"&&i.length>0){for(f=0,r=0;r<i.length;r++)f+=parseFloat(i[r].attributes.annual);var e=f/i.length,o=n.site.geometry.getGeodesicArea(pvMapper.siteLayer.projection),s=e/24*o/1e6;n.popupMessage=e.toFixed(2)+" kWh/m2/day\n("+s.toFixed(3)+" MW)",n.updateValue(e)}else n.popupMessage="No data for this site",n.updateValue(Number.NaN);else t.status===500?(n.popupMessage="Proxy connection error",n.updateValue(Number.NaN)):(n.popupMessage="Connection error "+t.status,n.updateValue(Number.NaN))}catch(h){n.popupMessage="Error",n.updateValue(Number.NaN)}}}var f=function(){function t(){var t=new pvMapper.Module({id:"IrradianceModule",author:"Scott Brown, INL",version:"0.1.ts",activate:function(){e()},deactivate:function(){o()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Direct-Normal Irradiation",description:"Calculates the expected DNI for a site",onScoreAdded:function(){},onSiteChange:function(t,i){n(i,"swera:dni_suny_high_900913")},updateScoreCallback:function(t){n(t,"swera:dni_suny_high_900913")}},{activate:null,deactivate:null,destroy:null,init:null,title:"Global-Horizontal Irradiation",description:"Calculates the expected GHI for a site",onScoreAdded:function(){},onSiteChange:function(t,i){n(i,"swera:ghi_suny_high_900913")},updateScoreCallback:function(t){n(t,"swera:ghi_suny_high_900913")}}],infoTools:null})}return t}(),h=new f,r="http://mapsdb.nrel.gov/geoserver/swera/wms",t,i})(INLModules||(INLModules={}))