var INLModules;(function(){function o(){n=r("swera:dni_suny_high_900913","Direct-Normal Irradiance 10km"),pvMapper.map.addLayer(n),t=r("swera:ghi_suny_high_900913","Global-Horizontal Irradiance 10km"),pvMapper.map.addLayer(t),i=r("swera:tilt_suny_high_900913","Tilted flat-plate Irradiance"),pvMapper.map.addLayer(i)}function r(n,t){var i=new OpenLayers.Layer.WMS(t,f,{layers:n,transparent:"true",format:"image/png",exceptions:"application/vnd.ogc.se_inimage",maxResolution:156543.0339,srs:"EPSG:900913"},{isBaseLayer:!1});return i.setOpacity(.3),i.setVisibility(!1),i}function s(){pvMapper.map.removeLayer(n,!1),pvMapper.map.removeLayer(t,!1),pvMapper.map.removeLayer(i,!1)}function u(n,t){var i={REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_xml",BBOX:n.site.geometry.bounds.toBBOX(6,!1),SERVICE:"WMS",INFO_FORMAT:"application/vnd.ogc.gml",QUERY_LAYERS:t,FEATURE_COUNT:50,Layers:t,WIDTH:1,HEIGHT:1,format:"image/gif",VERSION:"1.1.1",X:0,Y:0,I:0,J:0},r=OpenLayers.Request.GET({url:f,proxy:"/Proxy/proxy.ashx?",params:i,callback:h(n)})}function h(n){return function(t){var u,i,f,r;try{if(t.status===200)if(u=new OpenLayers.Format.GML,u.extractAttributes=!0,i=u.read(t.responseText),typeof i!="undefined"&&i.length>0){for(f=0,r=0;r<i.length;r++)f+=parseFloat(i[r].attributes.annual);var e=f/i.length,o=n.site.geometry.getGeodesicArea(pvMapper.siteLayer.projection),s=e/24*o/1e6;n.popupMessage=e.toFixed(2)+" kWh/m2/day\n("+s.toFixed(3)+" MW)",n.updateValue(e)}else n.popupMessage="No data for this site",n.updateValue(Number.NaN);else t.status===500?(n.popupMessage="Proxy connection error",n.updateValue(Number.NaN)):(n.popupMessage="Error "+t.status,n.updateValue(Number.NaN))}catch(h){n.popupMessage="Error",n.updateValue(Number.NaN)}}}var e=function(){function n(){var n=new pvMapper.Module({id:"IrradianceModule",author:"Scott Brown, INL",version:"0.1.ts",activate:function(){o()},deactivate:function(){s()},destroy:null,init:null,scoringTools:[{activate:null,deactivate:null,destroy:null,init:null,title:"Direct-Normal Irradiance",description:"The average annual DNI for a site, using SUNY irradiance maps hosted by NREL (maps.nrel.gov)",category:"Meteorology",onScoreAdded:function(){},onSiteChange:function(n,t){u(t,"swera:dni_suny_high_900913")},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,8,"Minimum Direct-Normal Irradiation allowed.","Maximum Direct-Normal Irradiation allowed.")},defaultWeight:10},{activate:null,deactivate:null,destroy:null,init:null,title:"Global-Horizontal Irradiance",description:"The average annual flat plate GHI for a site, using SUNY irradiance maps hosted by NREL (maps.nrel.gov)",category:"Meteorology",onScoreAdded:function(){},onSiteChange:function(n,t){u(t,"swera:ghi_suny_high_900913")},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,6)},defaultWeight:10},{activate:null,deactivate:null,destroy:null,init:null,title:"Tilted flat-plate Irradiance",description:"The average annual tilt irradiance for a site, using SUNY irradiance maps hosted by NREL (maps.nrel.gov)",category:"Meteorology",onScoreAdded:function(){},onSiteChange:function(n,t){u(t,"swera:tilt_suny_high_900913")},scoreUtilityOptions:{functionName:"linear",functionArgs:new pvMapper.MinMaxUtilityArgs(0,6)},defaultWeight:10}],infoTools:null})}return n}(),c=new e,f="http://mapsdb.nrel.gov/geoserver/swera/wms",n,t,i})(INLModules||(INLModules={}))