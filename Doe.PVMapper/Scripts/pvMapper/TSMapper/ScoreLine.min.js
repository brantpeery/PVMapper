var pvMapper;(function(n){var t=function(){function t(t){var i=this;this.scores=[],this.active=!0,this.scoreAddedEvent=new n.Event,this.scoreChangeEvent=new n.Event,this.updatingScoresEvent=new n.Event,this.self=this,this.name=typeof t.title=="string"?t.title:"Unnamed Tool",this.description=typeof t.description=="string"?t.description:"Unnamed Tool",this.category=typeof t.category=="string"?t.category:"Other",this.weight=1,$.isFunction(t.onSiteChange)&&(this.onSiteChangeHandler=t.onSiteChange),this.valueChangeHandler=function(n){n.score.setUtility(i.getUtilityScore(n.newValue)),i.scoreChangeEvent.fire(self,n)},$.isFunction(t.onScoreAdded)&&this.scoreAddedEvent.addHandler(t.onScoreAdded),n.siteManager.siteAdded.addHandler(function(n){console&&console.log("Siteadded event detected in scoreline"+name),i.addScore(n)}),n.siteManager.siteRemoved.addHandler(function(n){i.onSiteRemove(n)}),t.scoreUtilityOptions==undefined&&(t.scoreUtilityOptions={functionName:"random",functionArgs:{},iconURL:null}),this.scoreUtility=new n.ScoreUtility(t.scoreUtilityOptions),this.weight=typeof t.defaultWeight=="number"?t.defaultWeight:10,this.loadAllSites()}return t.prototype.getUtilityScore=function(n){return this.scoreUtility.run(n)},t.prototype.getWeight=function(){return this.weight},t.prototype.getWeightedUtilityScore=function(){return 0},t.prototype.addScore=function(t){var i=new n.Score(t);i.siteChangeEvent.addHandler(this.onSiteChangeHandler),i.valueChangeEvent.addHandler(this.valueChangeHandler),this.scores.push(i);try{this.onSiteChangeHandler(undefined,i)}catch(r){console&&console.error(r)}return i},t.prototype.updateScores=function(){this.scores.forEach(function(n){var t=n.value;n.setUtility(this.getUtilityScore(n.value)),this.scoreChangeEvent.fire(self,{score:n,oldValue:t,newValue:n.value})},this)},t.prototype.loadAllSites=function(){var t=n.siteManager.getSites();$.each(t,function(n,t){this.addScore(t)})},t.prototype.onSiteRemove=function(n){var t,i;for(console.log("Attempting to remove a site/score from the scoreline"),t=0;t<this.scores.length;t++)if(i=this.scores[t],i.site==n){i.siteChangeEvent.removeHandler(this.onSiteChangeHandler),i.valueChangeEvent.removeHandler(this.valueChangeHandler),this.scores.splice(t,1),this.scoreChangeEvent.fire(self,undefined);break}},t}();n.ScoreLine=t})(pvMapper||(pvMapper={}))