var pvMapper;(function(n){var t=function(){function t(t){var i=this;this.scores=[],this.active=!0,this.scoreChangeEvent=new n.Event,this.updatingScoresEvent=new n.Event,this.self=this,this.title=typeof t.title=="string"?t.title:"Unnamed Tool",t.description&&(this.description=t.description),this.category=typeof t.category=="string"?t.category:"Other",$.isFunction(t.onSiteChange)&&(this.onSiteChange=function(){return t.onSiteChange.apply(i,arguments)}),$.isFunction(t.getStarRatables)&&(this.getStarRatables=function(){return t.getStarRatables.apply(i,arguments)}),$.isFunction(t.showConfigWindow)&&(this.showConfigWindow=function(){t.showConfigWindow.apply(i,arguments)}),this.valueChangeHandler=function(n){n.score.setUtility(i.getUtilityScore(n.newValue)),i.scoreChangeEvent.fire(i,n)},n.siteManager.siteAdded.addHandler(function(n){console&&console.log("Siteadded event detected in scoreline"+name),i.addScore(n)}),t.scoreUtilityOptions==undefined&&(t.scoreUtilityOptions={functionName:"random",functionArgs:{className:"Random"},iconURL:null}),this.utilargs=new n.MinMaxUtilityArgs(0,0,"",""),this.scoreUtility=new n.ScoreUtility(t.scoreUtilityOptions),this.weight=typeof t.weight=="number"?t.weight:10,this.loadAllSites()}return t.prototype.getUtilityScore=function(n){return this.scoreUtility.run(n)},t.prototype.getWeight=function(){return this.weight},t.prototype.setWeight=function(n){this.weight=n,this.scoreChangeEvent.fire(self,undefined)},t.prototype.addScore=function(t){var i=new n.Score(t);i.siteChangeEvent.addHandler(this.onSiteChange),i.valueChangeEvent.addHandler(this.valueChangeHandler),this.scores.push(i);try{this.onSiteChange(undefined,i)}catch(r){console&&console.error(r)}return i},t.prototype.updateScores=function(){this.scores.forEach(function(n){var t=n.value;n.setUtility(this.getUtilityScore(n.value)),this.scoreChangeEvent.fire(this,{score:n,oldValue:t,newValue:n.value})},this)},t.prototype.loadAllSites=function(){var t=n.siteManager.getSites();$.each(t,function(n,t){this.addScore(t)})},t.prototype.onSiteRemove=function(n){var t,i;for(console.log("Attempting to remove a site/score from the scoreline"),t=0;t<this.scores.length;t++)if(i=this.scores[t],i.site==n){i.siteChangeEvent.removeHandler(this.onSiteChange),i.valueChangeEvent.removeHandler(this.valueChangeHandler),this.scores.splice(t,1),this.scoreChangeEvent.fire(self,undefined);break}},t}();n.ScoreLine=t})(pvMapper||(pvMapper={}))